      - name: Resolve KSU Meta Source
        id: manager
        run: |
          MANAGER_SOURCE="${{ github.event.inputs.MANAGER_SOURCE }}"
          KSU_META="${{ github.event.inputs.KSU_META }}"

          # Resolve branch + artifact
          case "$MANAGER_SOURCE" in
            SukiSU-Ultra-Main)
              BRANCH="main"
              ARTIFACT="Manager"
              ;;
            KernelSU-Next-Dev)
              BRANCH="dev"
              ARTIFACT="manager"
              ;;
            WildKSU-Stable)
              BRANCH="stable"
              ARTIFACT="manager"
              ;;
            WildKSU-Canary)
              BRANCH="canary"
              ARTIFACT="manager"
              ;;
            ReSukiSU-Main|*)
              BRANCH="main"
              ARTIFACT="Manager-release"
              ;;
          esac

          # Resolve Actual repository (CRITICAL FIX)
          case "$KSU_META" in
            SukiSU-Ultra)
              REPO="SukiSU-Ultra/SukiSU-Ultra"
              ;;
            KernelSU-Next)
              REPO="KernelSU-Next/KernelSU-Next"
              ;;
            WildKSU)
              REPO="WildKernels/Wild_KSU"
              ;;
            ReSukiSU)
              REPO="ReSukiSU/ReSukiSU"
              ;;
            *)
              echo "Unsupported KSU_META: $KSU_META"
              exit 1
              ;;
          esac

          echo "MANAGER_BRANCH=$BRANCH" >> "$GITHUB_OUTPUT"
          echo "MANAGER_ARTIFACT=$ARTIFACT" >> "$GITHUB_OUTPUT"
          echo "KSU_REPO=$REPO" >> "$GITHUB_OUTPUT"

          echo "Resolved:"
          echo "  Repo: $REPO"
          echo "  Branch: $BRANCH"
          echo "  Artifact: $ARTIFACT"



      - name: Download Latest KSU Meta Manager APK
        continue-on-error: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          REPO="${{ steps.manager.outputs.KSU_REPO }}"
          MANAGER_BRANCH="${{ steps.manager.outputs.MANAGER_BRANCH }}"
          MANAGER_ARTIFACT="${{ steps.manager.outputs.MANAGER_ARTIFACT }}"

          echo "Using Repo: $REPO"
          echo "Branch: $MANAGER_BRANCH"
          echo "Artifact: $MANAGER_ARTIFACT"

          # Get Latest Successful Workflow Run ID
          run_id=$(gh api \
            "repos/$REPO/actions/workflows/build-manager.yml/runs?branch=$MANAGER_BRANCH&status=success&per_page=1" \
            --jq '.workflow_runs[0].id' 2>/dev/null || echo "")

          if [[ -z "$run_id" ]]; then
            echo "No Successful Workflow Run Found"
            exit 0
          fi

          echo "Found Run ID: $run_id"

          # Get Artifact Download URL
          artifact_url=$(gh api \
            "repos/$REPO/actions/runs/$run_id/artifacts" \
            --jq ".artifacts[] | select(.name == \"$MANAGER_ARTIFACT\") | .archive_download_url" \
            | head -n1)

          if [[ -z "$artifact_url" ]]; then
            echo "Artifact '$MANAGER_ARTIFACT' Not Found in Run $run_id"
            exit 0
          fi

          echo "Downloading Artifact..."
          curl -fL \
            -H "Authorization: token $GITHUB_TOKEN" \
            -o "${MANAGER_ARTIFACT}.zip" \
            "$artifact_url"

          unzip -o -j "${MANAGER_ARTIFACT}.zip" "*.apk" -d ./AnyKernel3/

          echo "Manager APK Download Complete"
